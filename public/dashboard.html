<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBunmzsROUpo8miGHs9lffr70cRwX0cY98",
    authDomain: "bio-reator.firebaseapp.com",
    databaseURL: "https://bio-reator-default-rtdb.firebaseio.com/"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // -----------------------------
  //   GARANTE QUE "status" EXISTE
  // -----------------------------
  db.ref("status").once("value").then(snap => {
    if (!snap.exists()) {
      db.ref("status").set({
        temperatura: 0,
        bomba: "desligada"
      });
      console.log("Nó 'status' criado no banco.");
    } else {
      console.log("Nó 'status' já existe:", snap.val());
    }
  });

  // -----------------------------
  //   LISTENERS DO STATUS
  // -----------------------------
  db.ref("status/temperatura").on("value", snap => {
    const val = snap.val();
    document.getElementById("tempAtual").innerText = val ?? "--";
  });

  db.ref("status/bomba").on("value", snap => {
    const estado = snap.val();
    let texto = "--";

    if (estado === true || estado === "on" || estado === 1 || estado === "1") texto = "Ligada";
    else if (estado === false || estado === "off" || estado === 0 || estado === "0") texto = "Desligada";
    else if (estado) texto = String(estado);

    document.getElementById("statusBomba").innerText = texto;
  });

  // -----------------------------
  //   CONFIGURAÇÕES
  // -----------------------------
  db.ref("config").on("value", snap => {
    let c = snap.val();
    if (!c) return;

    document.getElementById("tempMax").value = c.temperatura_max ?? '';
    document.getElementById("tempMin").value = c.temperatura_min ?? '';
    document.getElementById("minLigado").value = c.intervalo_ligado ?? '';
    document.getElementById("minSem").value = c.intervalo_sem_mudanca ?? '';
  });

  function salvar() {
    db.ref("config").update({
      temperatura_max: parseFloat(document.getElementById("tempMax").value),
      temperatura_min: parseFloat(document.getElementById("tempMin").value),
      intervalo_ligado: parseInt(document.getElementById("minLigado").value),
      intervalo_sem_mudanca: parseInt(document.getElementById("minSem").value)
    });
    alert("Configurações salvas!");
  }
</script>
